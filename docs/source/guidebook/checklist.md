# «Шпаргалка»

## Базовые сущности

- WorkGraph — DAG проекта с двумя служебными вершинами start/finish; вершины — GraphNode с вложенным WorkUnit (описание
  работы), рёбра — зависимости (поддерживаются разные типы связей и лаги).
  > WorkGraph — граф работ проекта, где зафиксированы все задачи и их зависимости.

- GraphNode — вершина WorkGraph, хранящая WorkUnit и ссылки на родителей/потомков (с типами рёбер и лагами).
  > GraphNode — контейнер WorkUnit и связей в графе.

- WorkUnit — работа: объём, единицы измерения, приоритет, требования к ресурсам (WorkerReq: вид ресурса и мин/макс
  количество), сервисные флаги и др.
  > WorkUnit — описание одной задачи проекта с её характеристиками и потребностями в ресурсах.

- WorkerReq — требование работы к виду ресурса: specialty/kind, min_count, max_count, объём для нормирования
  длительности.
  > WorkerReq — «каких и сколько ресурсов нужно на эту задачу».

- Contractor — поставщик ресурсов: словари workers: dict[str, Worker] и equipments: dict[str, Equipment]; каждому Worker
  проставляется contractor_id.
  > Contractor — организация или подразделение, предоставляющее людей и технику.

- Worker — ресурс «люди»: наименование специальности, count, contractor_id, режим/распределение производительности.
  > Worker — трудовой ресурс с численностью и производительностью (иногда со стоимостной оценкой).

- Equipment — ресурс «техника» с типом и количеством.
  > Equipment — оборудование, используемое в проекте.

---

## Планировщик и результат

- Scheduler — алгоритм планирования. Принимает WorkGraph и список Contractor (опционально spec, landscape,
  work_estimator). Возвращает список Schedule. Расширенный метод `schedule_with_cache` возвращает кортежи
  `(Schedule, start_time: Time, Timeline, node_order: list[GraphNode])`.
  > Scheduler — модуль, который строит расписание по задачам и ресурсам. Базовый `schedule` возвращает `list[Schedule]`;
  на практике берут первый план: `schedule(...)[0]`.

- Schedule — расписание: агрегирует данные о стартах/финишах, назначениях ресурсов и др.; содержит метрику
  `execution_time` (makespan).
  > Schedule — итоговый план выполнения работ с назначенными ресурсами и сроками.

- ScheduledWork — элемент расписания: конкретная работа с назначенными ресурсами, стартом/финишом и длительностью.
  > ScheduledWork — «строка» плана по одной работе.

- ScheduleSpec — спецификация для ограничений/назначений ресурсов на работы (в т.ч. фиксирование объёмов команд).
  > ScheduleSpec — настройки, ограничивающие или уточняющие распределение ресурсов.

- Timeline — внутренняя временная шкала использования ресурсов, которую поддерживает планировщик при вычислениях.
  > Timeline — модель занятости ресурсов во времени.

---

## Оценки и окружение

- WorkTimeEstimator — оценщик длительности работ, подставляется в планировщик через `work_estimator`.
  > WorkTimeEstimator — функция или модель, определяющая длительность выполнения задачи.

- LandscapeConfiguration / ZoneConfiguration — конфигурация пространственных/зональных ограничений и смен статусов зон (
  при необходимости).
  > Landscape/ZoneConfiguration — описание территории или зоны выполнения работ с ограничениями.

---

## Пайплайн

- SchedulingPipeline — «флюентный» builder-интерфейс для конфигурирования и запуска планирования:
  `SchedulingPipeline.create() → ... → .finish() → ScheduledProject` (`project.schedule`).
  > «Флюентный» builder — цепочка методов, где вы задаёте граф работ, ресурсы и опции, выбираете алгоритм и получаете
  результат как `ScheduledProject`.

Кратко о методах пайплайна (рекомендуемый порядок):

1) `create()` — старт билдера.
2) `name_mapper(mapper|path)` — (опционально) нормализация/переименование работ и ресурсов.
3) `wg(x, all_connections=False, change_connections_info=False, sep=',')` — задать WorkGraph (объект/таблица/файл).
4) `contractors(x)` — задать подрядчиков (список/таблица/файл или генерация).
5) `history(data, sep=';')` — (опционально) исторические данные со связями; требуется, если в графе нет информации о
   зависимостях.
6) `work_estimator(est)` — (опционально) модель оценки длительностей.
7) `spec(spec)` — (опционально) ограничения/фиксация ресурсов и этапов.
8) `landscape(cfg)` — (опционально) пространственные/зональные ограничения.
9) `time_shift(offset: Time)` — (опционально) сдвиг начала расписания/дат.
10) `lag_optimize(strategy)` — (желательно) стратегия оптимизации лагов; в дефолтном пайплайне может быть подобрана
    автоматически, если не указана.
11) `node_order(orders: list[list[GraphNode]])` — (опционально) зафиксировать порядок узлов до планирования.
12) `optimize_local(optimizer: OrderLocalOptimizer, area: range)` — (опционально) локальная оптимизация порядка ДО
    `schedule`.
13) `schedule(scheduler, validate=False)` — выбрать алгоритм и построить расписание.
14) `optimize_local(optimizer: ScheduleLocalOptimizer, area: range)` — (опционально) локальная оптимизация расписания
    ПОСЛЕ `schedule`.
15) `visualization(start_date)` — (опционально) визуализация плана; далее можно вызвать `.shape(...)`,
    `.color_type(...)`, `.show_gant_chart()`.
16) `finish()` — получить результат как `list[ScheduledProject]` (обычно берут `[0]`).

- ScheduledProject — контейнер с результатом проекта (включая `project.schedule`), доступен после `finish()`.
  > ScheduledProject — объект с итоговым расписанием проекта.

Примечание: `optimize_local` присутствует в двух вариантах — для порядка (OrderLocalOptimizer, до планирования) и для
готового расписания (ScheduleLocalOptimizer, после планирования).

---
